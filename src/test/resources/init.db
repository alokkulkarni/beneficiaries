-- Schema for beneficiaries table (plural to match Spring Data JDBC table name)
CREATE TABLE IF NOT EXISTS beneficiaries (
    id BIGSERIAL PRIMARY KEY,
    customer_id VARCHAR(255) NOT NULL,
    account_number VARCHAR(255),
    beneficiary_name VARCHAR(255) NOT NULL,
    beneficiary_account_number VARCHAR(255) NOT NULL,
    beneficiary_bank_code VARCHAR(255) NOT NULL,
    beneficiary_bank_name VARCHAR(255) NOT NULL,
    beneficiary_type VARCHAR(50) NOT NULL,
    status VARCHAR(50) DEFAULT 'ACTIVE',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT unique_customer_beneficiary_account UNIQUE (customer_id, beneficiary_account_number, status)
);

-- Indexes for performance
CREATE INDEX IF NOT EXISTS idx_customer_id ON beneficiaries(customer_id);
CREATE INDEX IF NOT EXISTS idx_account_number ON beneficiaries(account_number);
CREATE INDEX IF NOT EXISTS idx_status ON beneficiaries(status);

-- Test data for BDD scenarios
-- Data for update/retrieve scenarios (ID 1, CUST001) - NEVER deleted
INSERT INTO beneficiaries (id, customer_id, account_number, beneficiary_name, beneficiary_account_number, beneficiary_bank_code, beneficiary_bank_name, beneficiary_type, status, created_at, updated_at)
VALUES 
(1, 'CUST001', 'ACC001', 'Old Name', '12345678', 'BANK001', 'Old Bank', 'DOMESTIC', 'ACTIVE', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);

-- Data for delete scenarios (IDs 2, 3, 4 - different customers to avoid conflicts with other scenarios)
INSERT INTO beneficiaries (id, customer_id, account_number, beneficiary_name, beneficiary_account_number, beneficiary_bank_code, beneficiary_bank_name, beneficiary_type, status, created_at, updated_at)
VALUES 
(2, 'CUST006', 'ACC006', 'Jane Smith', '23456789', 'BANK002', 'Test Bank 2', 'DOMESTIC', 'ACTIVE', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
(3, 'CUST007', 'ACC007', 'Bob Johnson', '34567890', 'BANK003', 'Test Bank 3', 'DOMESTIC', 'ACTIVE', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
(4, 'CUST003', 'ACC003', 'Deleted User', '45678901', 'BANK004', 'Test Bank 4', 'DOMESTIC', 'ACTIVE', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);

-- Data for duplicate check (ID 5, CUST003 - conflicts with BEN003 above)
INSERT INTO beneficiaries (id, customer_id, account_number, beneficiary_name, beneficiary_account_number, beneficiary_bank_code, beneficiary_bank_name, beneficiary_type, status, created_at, updated_at)
VALUES 
(5, 'CUST003', 'ACC003', 'Existing User', '12341234', 'BANK004', 'Test Bank 4', 'DOMESTIC', 'ACTIVE', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);

-- Data for retrieve all beneficiaries for a customer (CUST002 has multiple)
INSERT INTO beneficiaries (id, customer_id, account_number, beneficiary_name, beneficiary_account_number, beneficiary_bank_code, beneficiary_bank_name, beneficiary_type, status, created_at, updated_at)
VALUES 
(10, 'CUST002', 'ACC010', 'Beneficiary One', '56789012', 'BANK006', 'Test Bank 6', 'DOMESTIC', 'ACTIVE', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
(11, 'CUST002', 'ACC011', 'Beneficiary Two', '67890123', 'BANK006', 'Test Bank 6', 'INTERNATIONAL', 'ACTIVE', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
(12, 'CUST002', 'ACC012', 'Beneficiary Three', '78901234', 'BANK006', 'Test Bank 6', 'DOMESTIC', 'ACTIVE', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);

-- Data for retrieve by customer and account number (CUST003)
INSERT INTO beneficiaries (id, customer_id, account_number, beneficiary_name, beneficiary_account_number, beneficiary_bank_code, beneficiary_bank_name, beneficiary_type, status, created_at, updated_at)
VALUES 
(20, 'CUST003', 'ACC_A', 'Account A User', '89012345', 'BANK007', 'Test Bank 7', 'DOMESTIC', 'ACTIVE', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
(21, 'CUST003', 'ACC_B', 'Account B User', '90123456', 'BANK007', 'Test Bank 7', 'INTERNATIONAL', 'ACTIVE', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
(22, 'CUST003', 'ACC_A', 'Another A User', '01234567', 'BANK007', 'Test Bank 7', 'DOMESTIC', 'ACTIVE', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);

-- Data for null/empty account number scenarios (CUST004 and CUST005)
INSERT INTO beneficiaries (id, customer_id, account_number, beneficiary_name, beneficiary_account_number, beneficiary_bank_code, beneficiary_bank_name, beneficiary_type, status, created_at, updated_at)
VALUES 
(30, 'CUST004', 'ACC030', 'User One', '11111111', 'BANK008', 'Test Bank 8', 'DOMESTIC', 'ACTIVE', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
(31, 'CUST004', 'ACC031', 'User Two', '22222222', 'BANK008', 'Test Bank 8', 'INTERNATIONAL', 'ACTIVE', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
(40, 'CUST005', 'ACC040', 'User Alpha', '33333333', 'BANK009', 'Test Bank 9', 'DOMESTIC', 'ACTIVE', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
(41, 'CUST005', 'ACC041', 'User Beta', '44444444', 'BANK009', 'Test Bank 9', 'INTERNATIONAL', 'ACTIVE', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);

-- Data for analytics methods testing (CUST_ANALYTICS)
-- Test data for getCustomerBeneficiaryAnalytics, findPotentialDuplicates, getBeneficiaryUsageReport
INSERT INTO beneficiaries (id, customer_id, account_number, beneficiary_name, beneficiary_account_number, beneficiary_bank_code, beneficiary_bank_name, beneficiary_type, status, created_at, updated_at)
VALUES 
-- Active beneficiaries
(50, 'CUST_ANALYTICS', 'ACC_ANALYTICS_01', 'John Doe', '111222333', 'BANK010', 'Analytics Bank', 'DOMESTIC', 'ACTIVE', CURRENT_TIMESTAMP - INTERVAL '10 days', CURRENT_TIMESTAMP),
(51, 'CUST_ANALYTICS', 'ACC_ANALYTICS_02', 'Jane Smith', '222333444', 'BANK010', 'Analytics Bank', 'INTERNATIONAL', 'ACTIVE', CURRENT_TIMESTAMP - INTERVAL '8 days', CURRENT_TIMESTAMP),
(52, 'CUST_ANALYTICS', 'ACC_ANALYTICS_03', 'Bob Johnson', '333444555', 'BANK011', 'Another Bank', 'DOMESTIC', 'ACTIVE', CURRENT_TIMESTAMP - INTERVAL '5 days', CURRENT_TIMESTAMP),
-- Inactive beneficiaries
(53, 'CUST_ANALYTICS', 'ACC_ANALYTICS_04', 'Alice Williams', '444555666', 'BANK011', 'Another Bank', 'DOMESTIC', 'INACTIVE', CURRENT_TIMESTAMP - INTERVAL '20 days', CURRENT_TIMESTAMP),
(54, 'CUST_ANALYTICS', 'ACC_ANALYTICS_05', 'Charlie Brown', '555666777', 'BANK010', 'Analytics Bank', 'INTERNATIONAL', 'INACTIVE', CURRENT_TIMESTAMP - INTERVAL '15 days', CURRENT_TIMESTAMP),
-- Similar names for duplicate detection
(55, 'CUST_ANALYTICS', 'ACC_ANALYTICS_06', 'John Doe', '666777888', 'BANK012', 'Test Bank 12', 'DOMESTIC', 'ACTIVE', CURRENT_TIMESTAMP - INTERVAL '3 days', CURRENT_TIMESTAMP),
(56, 'CUST_ANALYTICS', 'ACC_ANALYTICS_07', 'JohnDoe', '777888999', 'BANK012', 'Test Bank 12', 'DOMESTIC', 'ACTIVE', CURRENT_TIMESTAMP - INTERVAL '2 days', CURRENT_TIMESTAMP),
(57, 'CUST_ANALYTICS', 'ACC_ANALYTICS_08', 'Bob Johnston', '888999000', 'BANK011', 'Another Bank', 'INTERNATIONAL', 'ACTIVE', CURRENT_TIMESTAMP - INTERVAL '1 day', CURRENT_TIMESTAMP);

-- Reset sequence to avoid conflicts with test data
SELECT setval('beneficiaries_id_seq', 100, true);
